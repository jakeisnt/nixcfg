#!/usr/bin/env nu

# Collect garbage from the nix store
def "main gc" [] {
  nix-collect-garbage -d
}

# Rebuild the NixOS system
def "main rebuild" [] {
  sudo nixos-rebuild switch --flake /etc/nixos --option pure-eval no
}

# find a package with the given name
# TODO why is this so slow??
def "main find" [
  package_name: string # the name of the package to locate
] {
  nix search nixos $package_name
}

# Upgrade the system's NixOS flake
def "main upgrade" [] {
  nix flake update /etc/nixos --impure
  main rebuild
}

# Rebuild for and deploy to a remote server
# TODO: Find out more about this!
# nixbuild: https://nixbuild.net: provides remote linux builders as a service :D
# `bou.ke` has some cool nix lore to learn
# can set up with https://docs.nixbuild.net/getting-started
def "main deploy" [] {
  nix run nixpkgs#nixos-reubild -- --fast --target-host jake@isnt.online --build-host jake@isnt.online .#vultr --use-remote-sudo switch
}


# Welcome to Nix!
def main [] {
  echo "Hey!"
}
